{"version":3,"file":"cocoapod.js","sourceRoot":"","sources":["../../../src/apple/cocoapod.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,uCAAyB;AACzB,2CAA6B;AAC7B,oDAAsC;AACtC,qDAAuC;AACvC,+EAA+E;AAC/E,sDAAwC;AACxC,kDAA0B;AAE1B,SAAgB,YAAY,CAAC,QAAgB;IAC3C,OAAO,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC,CAAC;AACvD,CAAC;AAFD,oCAEC;AAEM,KAAK,UAAU,YAAY,CAAC,QAAgB;IACjD,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;IAE/C,MAAM,UAAU,GAAG,EAAE,CAAC,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IAEpD,IACE,wDAAwD,CAAC,IAAI,CAAC,UAAU,CAAC,EACzE;QACA,0BAA0B;QAC1B,OAAO,IAAI,CAAC;KACb;IAED,IAAI,QAAQ,GAAG,+BAA+B,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IAChE,IAAI,CAAC,QAAQ,EAAE;QACb,0EAA0E;QAC1E,MAAM,cAAc,GAAG,iCAAiC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAC1E,IAAI,CAAC,cAAc,EAAE;YACnB,OAAO,KAAK,CAAC;SACd;QACD,QAAQ,GAAG,cAAc,CAAC;KAC3B;IAED,MAAM,WAAW,GAAG,QAAQ,CAAC,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;IACxD,MAAM,cAAc,GAClB,UAAU,CAAC,KAAK,CAAC,CAAC,EAAE,WAAW,CAAC;QAChC,IAAI;QACJ,QAAQ,CAAC,CAAC,CAAC;QACX,gBAAgB;QAChB,UAAU,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;IAChC,EAAE,CAAC,aAAa,CAAC,OAAO,EAAE,cAAc,EAAE,MAAM,CAAC,CAAC;IAElD,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,0CAA0C,CAAC,CAAC;IAE3D,MAAM,UAAU,EAAE,CAAC;IAEnB,OAAO,IAAI,CAAC;AACd,CAAC;AApCD,oCAoCC;AAEM,KAAK,UAAU,UAAU,CAAC,GAAG,GAAG,GAAG;IACxC,MAAM,cAAc,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;IACvC,cAAc,CAAC,KAAK,CAAC,uDAAuD,CAAC,CAAC;IAE9E,IAAI;QACF,MAAM,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,qBAAqB,CAAC,CAAC;QACnD,MAAM,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,0BAA0B,CAAC,CAAC;QACxD,cAAc,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QACvC,MAAM,CAAC,MAAM,CAAC,gBAAgB,EAAE,IAAI,CAAC,CAAC;KACvC;IAAC,OAAO,CAAC,EAAE;QACV,cAAc,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;QAC/C,MAAM,CAAC,MAAM,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC;QACvC,KAAK,CAAC,GAAG,CAAC,KAAK,CACb,GAAG,eAAK,CAAC,GAAG,CACV,2DAA2D,CAE5D,OAAO,CAAC,OAAO,eAAK,CAAC,GAAG,CACvB,8HAA8H,CAC/H,EAAE,CACJ,CAAC;QACF,MAAM,CAAC,gBAAgB,CAAC,4BAA4B,CAAC,CAAC;KACvD;AACH,CAAC;AAtBD,gCAsBC","sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport * as bash from '../utils/bash';\nimport * as Sentry from '@sentry/node';\n// @ts-expect-error - clack is ESM and TS complains about that. It works though\nimport * as clack from '@clack/prompts';\nimport chalk from 'chalk';\n\nexport function usesCocoaPod(projPath: string): boolean {\n  return fs.existsSync(path.join(projPath, 'Podfile'));\n}\n\nexport async function addCocoaPods(projPath: string): Promise<boolean> {\n  const podfile = path.join(projPath, 'Podfile');\n\n  const podContent = fs.readFileSync(podfile, 'utf8');\n\n  if (\n    /^\\s*pod\\s+(['\"]Sentry['\"]|['\"]SentrySwiftUI['\"])\\s*$/im.test(podContent)\n  ) {\n    // Already have Sentry pod\n    return true;\n  }\n\n  let podMatch = /^( *)pod\\s+['\"](\\w+)['\"] *$/im.exec(podContent);\n  if (!podMatch) {\n    // No Podfile is empty, will try to add Sentry pod after \"use_frameworks!\"\n    const frameworkMatch = /^( *)use_frameworks![^\\n]* *$/im.exec(podContent);\n    if (!frameworkMatch) {\n      return false;\n    }\n    podMatch = frameworkMatch;\n  }\n\n  const insertIndex = podMatch.index + podMatch[0].length;\n  const newFileContent =\n    podContent.slice(0, insertIndex) +\n    '\\n' +\n    podMatch[1] +\n    \"pod 'Sentry'\\n\" +\n    podContent.slice(insertIndex);\n  fs.writeFileSync(podfile, newFileContent, 'utf8');\n\n  clack.log.step('Sentry pod added to the project podFile.');\n\n  await podInstall();\n\n  return true;\n}\n\nexport async function podInstall(dir = '.') {\n  const installSpinner = clack.spinner();\n  installSpinner.start(\"Running 'pod install'. This may take a few minutes...\");\n\n  try {\n    await bash.execute(`cd ${dir} && pod repo update`);\n    await bash.execute(`cd ${dir} && pod install --silent`);\n    installSpinner.stop('Pods installed.');\n    Sentry.setTag('pods-installed', true);\n  } catch (e) {\n    installSpinner.stop('Failed to install pods.');\n    Sentry.setTag('pods-installed', false);\n    clack.log.error(\n      `${chalk.red(\n        'Encountered the following error during pods installation:',\n        // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      )}\\n\\n${e}\\n\\n${chalk.dim(\n        'If you think this issue is caused by the Sentry wizard, let us know here:\\nhttps://github.com/getsentry/sentry-wizard/issues',\n      )}`,\n    );\n    Sentry.captureException('Sentry pod install failed.');\n  }\n}\n"]}