{"version":3,"file":"sdk-example.js","sourceRoot":"","sources":["../../../src/nuxt/sdk-example.ts"],"names":[],"mappings":"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","sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\n// @ts-expect-error - clack is ESM and TS complains about that. It works though\nimport clack from '@clack/prompts';\nimport {\n  getIndexRouteTemplate,\n  getSentryExampleApiTemplate,\n  getSentryExamplePageTemplate,\n  getSentryErrorButtonTemplate,\n} from './templates';\nimport { abort, isUsingTypeScript } from '../utils/clack';\nimport chalk from 'chalk';\nimport * as Sentry from '@sentry/node';\n\nfunction getSrcDirectory(isNuxtV4: boolean) {\n  // In nuxt v4, the src directory is `app/` unless\n  // users already had a `pages` directory\n  return isNuxtV4 && !fs.existsSync(path.resolve('pages')) ? 'app' : '.';\n}\n\nexport async function supportsExamplePage(isNuxtV4: boolean) {\n  // We currently only support creating an example page\n  // if users can reliably access it without having to\n  // add code changes themselves.\n  //\n  // If users have an `app.vue` layout without the\n  // needed component to render routes (<NuxtPage/>),\n  // we bail out of creating an example page altogether.\n  const src = getSrcDirectory(isNuxtV4);\n  const app = path.join(src, 'app.vue');\n\n  // If there's no `app.vue` layout, nuxt automatically renders\n  // the routes.\n  if (!fs.existsSync(path.resolve(app))) {\n    return true;\n  }\n\n  const content = await fs.promises.readFile(path.resolve(app), 'utf8');\n  return !!content.match(/<NuxtPage/g);\n}\n\nexport async function createExamplePage(\n  isNuxtV4: boolean,\n  options: {\n    org: string;\n    project: string;\n    projectId: string;\n    url: string;\n  },\n) {\n  try {\n    const src = getSrcDirectory(isNuxtV4);\n    const pages = path.join(src, 'pages');\n\n    if (!fs.existsSync(path.resolve(pages))) {\n      fs.mkdirSync(path.resolve(pages), { recursive: true });\n\n      const indexPage = path.join(pages, 'index.vue');\n\n      await fs.promises.writeFile(\n        path.resolve(indexPage),\n        getIndexRouteTemplate(),\n      );\n\n      clack.log.success(`Created ${chalk.cyan(indexPage)}.`);\n    }\n\n    const examplePage = path.join(pages, 'sentry-example-page.vue');\n\n    if (fs.existsSync(path.resolve(examplePage))) {\n      clack.log.warn(\n        `It seems like a sentry example page already exists. Skipping creation of example page.`,\n      );\n      return;\n    }\n\n    await fs.promises.writeFile(\n      path.resolve(examplePage),\n      getSentryExamplePageTemplate(options),\n    );\n\n    clack.log.success(`Created ${chalk.cyan(examplePage)}.`);\n\n    const api = path.join('server', 'api');\n\n    if (!fs.existsSync(path.resolve(api))) {\n      fs.mkdirSync(path.resolve(api), { recursive: true });\n    }\n\n    const exampleApi = path.join(\n      api,\n      isUsingTypeScript() ? 'sentry-example-api.ts' : 'sentry-example-api.js',\n    );\n\n    await fs.promises.writeFile(\n      path.resolve(exampleApi),\n      getSentryExampleApiTemplate(),\n    );\n\n    clack.log.success(`Created ${chalk.cyan(exampleApi)}.`);\n  } catch (e: unknown) {\n    clack.log.error('Error while creating an example page to test Sentry:');\n    clack.log.info(\n      chalk.dim(\n        typeof e === 'object' && e != null && 'toString' in e\n          ? e.toString()\n          : typeof e === 'string'\n          ? e\n          : 'Unknown error',\n      ),\n    );\n    Sentry.captureException(\n      'Error while creating an example Nuxt page to test Sentry',\n    );\n    await abort('Exiting Wizard');\n  }\n}\n\nexport async function createExampleComponent(isNuxtV4: boolean) {\n  const src = getSrcDirectory(isNuxtV4);\n  const components = path.join(src, 'components');\n\n  if (!fs.existsSync(path.resolve(components))) {\n    fs.mkdirSync(path.resolve(components), { recursive: true });\n  }\n\n  const exampleComponent = path.join(components, 'SentryErrorButton.vue');\n\n  await fs.promises.writeFile(\n    path.resolve(exampleComponent),\n    getSentryErrorButtonTemplate(),\n  );\n\n  clack.log.success(`Created ${chalk.cyan(exampleComponent)}.`);\n}\n"]}