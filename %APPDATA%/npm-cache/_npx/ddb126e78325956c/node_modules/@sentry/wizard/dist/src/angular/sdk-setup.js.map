{"version":3,"file":"sdk-setup.js","sourceRoot":"","sources":["../../../src/angular/sdk-setup.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n\n// @ts-expect-error - magicast is ESM and TS complains about that. It works though\nimport { loadFile, writeFile } from 'magicast';\n\nimport * as fs from 'fs';\nimport * as path from 'path';\n\n// @ts-expect-error - clack is ESM and TS complains about that. It works though\nimport clack from '@clack/prompts';\nimport chalk from 'chalk';\nimport { updateAppConfigMod } from './codemods/app-config';\nimport { updateAppEntryMod } from './codemods/main';\nimport { hasSentryContent } from '../utils/ast-utils';\nimport * as Sentry from '@sentry/node';\n\nimport type { namedTypes as t } from 'ast-types';\nimport type { SemVer } from 'semver';\n\nexport async function initalizeSentryOnApplicationEntry(\n  dsn: string,\n  selectedFeatures: {\n    performance: boolean;\n    replay: boolean;\n  },\n): Promise<void> {\n  const appEntryFilename = 'main.ts';\n  const appEntryPath = path.join(process.cwd(), 'src', appEntryFilename);\n\n  const originalAppEntry = await loadFile(appEntryPath);\n\n  if (hasSentryContent(originalAppEntry.$ast as t.Program)) {\n    clack.log.warn(\n      `File ${chalk.cyan(appEntryFilename)} already contains Sentry.\nSkipping adding Sentry functionality to ${chalk.cyan(appEntryFilename)}.`,\n    );\n\n    return;\n  }\n\n  const updatedAppEntryMod = updateAppEntryMod(\n    originalAppEntry,\n    dsn,\n    selectedFeatures,\n  );\n\n  try {\n    await writeFile(updatedAppEntryMod.$ast, appEntryPath);\n  } catch (error: unknown) {\n    clack.log.error(\n      `Error while adding Sentry to ${chalk.cyan(appEntryFilename)}`,\n    );\n\n    clack.log.warn(\n      `Please refer to the documentation for manual setup:\n${chalk.underline(\n  'https://docs.sentry.io/platforms/javascript/guides/angular/#configure',\n)}`,\n    );\n\n    return;\n  }\n\n  clack.log.success(\n    `Successfully initialized Sentry on ${chalk.cyan(appEntryFilename)}`,\n  );\n}\n\nexport async function updateAppConfig(\n  angularVersion: SemVer,\n  isTracingEnabled: boolean,\n): Promise<void> {\n  const appConfigFilename = 'app.config.ts';\n  const appConfigPath = path.join(\n    process.cwd(),\n    'src',\n    'app',\n    appConfigFilename,\n  );\n\n  if (!fs.existsSync(appConfigPath)) {\n    Sentry.setTag('angular-app-config-found', false);\n\n    clack.log.warn(\n      `File ${chalk.cyan(\n        appConfigFilename,\n      )} not found. Skipping adding Sentry functionality.`,\n    );\n\n    clack.log.warn(`Please refer to the documentation for manual setup:\n${chalk.underline(\n  'https://docs.sentry.io/platforms/javascript/guides/angular/#configure',\n)}`);\n\n    return;\n  }\n\n  Sentry.setTag('angular-app-config-found', true);\n\n  const appConfig = await loadFile(appConfigPath);\n\n  if (hasSentryContent(appConfig.$ast as t.Program)) {\n    clack.log.warn(\n      `File ${chalk.cyan(appConfigFilename)} already contains Sentry.\n  Skipping adding Sentry functionality to ${chalk.cyan(appConfigFilename)}.`,\n    );\n\n    return;\n  }\n\n  try {\n    const updatedAppConfigMod = updateAppConfigMod(\n      appConfig,\n      angularVersion,\n      isTracingEnabled,\n    );\n\n    await writeFile(updatedAppConfigMod.$ast, appConfigPath);\n  } catch (error: unknown) {\n    clack.log.error(\n      `Error while updating your app config ${chalk.cyan(appConfigFilename)}.`,\n    );\n\n    clack.log.info(\n      chalk.dim(\n        typeof error === 'object' && error != null && 'toString' in error\n          ? error.toString()\n          : typeof error === 'string'\n          ? error\n          : '',\n      ),\n    );\n\n    clack.log.warn(`Please refer to the documentation for manual setup:\n${chalk.underline(\n  'https://docs.sentry.io/platforms/javascript/guides/angular/#configure',\n)}`);\n\n    return;\n  }\n\n  clack.log.success(\n    `Successfully updated your app config ${chalk.cyan(appConfigFilename)}`,\n  );\n}\n"]}