{"version":3,"file":"nextjs-15.test.js","sourceRoot":"","sources":["../../../e2e-tests/tests/nextjs-15.test.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,gDAAkC;AAClC,mDAAkD;AAClD,oCAKkB;AAClB,oCAA+C;AAC/C,oCAOkB;AAClB,mCAA6D;AAE7D,IAAA,iBAAQ,EAAC,WAAW,EAAE,GAAG,EAAE;IACzB,MAAM,WAAW,GAAG,uBAAW,CAAC,MAAM,CAAC;IACvC,MAAM,UAAU,GAAG,IAAI,CAAC,OAAO,CAC7B,SAAS,EACT,yCAAyC,CAC1C,CAAC;IAEF,IAAA,kBAAS,EAAC,KAAK,IAAI,EAAE;QACnB,MAAM,cAAc,GAAG,IAAA,2BAAmB,EAAC,WAAW,EAAE,UAAU,CAAC,CAAC;QACpE,MAAM,sBAAsB,GAAG,MAAM,cAAc,CAAC,aAAa,CAC/D,qCAAqC,CACtC,CAAC;QAEF,MAAM,0BAA0B,GAC9B,sBAAsB;YACtB,CAAC,MAAM,cAAc,CAAC,yBAAyB;YAC7C,0CAA0C;YAC1C,CAAC,YAAI,CAAC,IAAI,EAAE,YAAI,CAAC,KAAK,CAAC,EACvB,iFAAiF,EACjF;gBACE,OAAO,EAAE,MAAO;aACjB,CACF,CAAC,CAAC;QAEL,MAAM,qBAAqB,GACzB,0BAA0B;YAC1B,CAAC,MAAM,cAAc,CAAC,yBAAyB,CAC7C,CAAC,YAAI,CAAC,KAAK,CAAC;YACZ,+FAA+F;YAC/F,+CAA+C,CAChD,CAAC,CAAC;QAEL,MAAM,oBAAoB,GACxB,qBAAqB;YACrB,CAAC,MAAM,cAAc,CAAC,yBAAyB,CAC7C,CAAC,YAAI,CAAC,KAAK,CAAC;YACZ,2HAA2H;YAC3H,mEAAmE,CACpE,CAAC,CAAC;QAEL,MAAM,mBAAmB,GACvB,oBAAoB;YACpB,CAAC,MAAM,cAAc,CAAC,yBAAyB,CAC7C,CAAC,YAAI,CAAC,KAAK,CAAC,EACZ,uCAAuC,EACvC;gBACE,QAAQ,EAAE,IAAI;aACf,CACF,CAAC,CAAC;QAEL,MAAM,YAAY,GAChB,mBAAmB;YACnB,CAAC,MAAM,cAAc,CAAC,yBAAyB,CAC7C,CAAC,YAAI,CAAC,KAAK,CAAC,EACZ,4BAA4B,CAC7B,CAAC,CAAC;QAEL,YAAY;YACV,CAAC,MAAM,cAAc,CAAC,yBAAyB;YAC7C,gCAAgC;YAChC,CAAC,YAAI,CAAC,IAAI,EAAE,YAAI,CAAC,KAAK,CAAC,EACvB,gDAAgD,CACjD,CAAC,CAAC;QAEL,cAAc,CAAC,IAAI,EAAE,CAAC;IACxB,CAAC,CAAC,CAAC;IAEH,IAAA,iBAAQ,EAAC,GAAG,EAAE;QACZ,IAAA,0BAAkB,EAAC,UAAU,CAAC,CAAC;QAC/B,IAAA,kBAAU,EAAC,UAAU,CAAC,CAAC;IACzB,CAAC,CAAC,CAAC;IAEH,IAAA,aAAI,EAAC,mCAAmC,EAAE,GAAG,EAAE;QAC7C,IAAA,wBAAgB,EAAC,UAAU,EAAE,WAAW,CAAC,CAAC;IAC5C,CAAC,CAAC,CAAC;IAEH,IAAA,aAAI,EAAC,iEAAiE,EAAE,GAAG,EAAE;QAC3E,IAAA,2BAAmB,EAAC,UAAU,CAAC,CAAC;IAClC,CAAC,CAAC,CAAC;IAEH,IAAA,aAAI,EAAC,qBAAqB,EAAE,GAAG,EAAE;QAC/B,IAAA,uBAAe,EAAC,GAAG,UAAU,uCAAuC,CAAC,CAAC;QACtE,IAAA,uBAAe,EAAC,GAAG,UAAU,0CAA0C,CAAC,CAAC;IAC3E,CAAC,CAAC,CAAC;IAEH,IAAA,aAAI,EAAC,sBAAsB,EAAE,GAAG,EAAE;QAChC,IAAA,uBAAe,EAAC,GAAG,UAAU,0BAA0B,CAAC,CAAC;QACzD,IAAA,uBAAe,EAAC,GAAG,UAAU,wBAAwB,CAAC,CAAC;IACzD,CAAC,CAAC,CAAC;IAEH,IAAA,aAAI,EAAC,0BAA0B,EAAE,GAAG,EAAE;QACpC,IAAA,uBAAe,EAAC,GAAG,UAAU,2BAA2B,CAAC,CAAC;IAC5D,CAAC,CAAC,CAAC;IAEH,IAAA,aAAI,EAAC,8BAA8B,EAAE,GAAG,EAAE;QACxC,IAAA,uBAAe,EAAC,GAAG,UAAU,yBAAyB,CAAC,CAAC;QACxD,IAAA,uBAAe,EAAC,GAAG,UAAU,gCAAgC,CAAC,CAAC;IACjE,CAAC,CAAC,CAAC;IAEH,IAAA,aAAI,EAAC,qDAAqD,EAAE,GAAG,EAAE;QAC/D,IAAA,yBAAiB,EAAC,GAAG,UAAU,yBAAyB,EAAE;YACxD,2CAA2C;YAC3C;;;;;;;;;;0DAUoD;SACrD,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,aAAI,EAAC,0CAA0C,EAAE,GAAG,EAAE;QACpD,IAAA,yBAAiB,EAAC,GAAG,UAAU,iBAAiB,EAAE;YAChD,iDAAiD;YACjD,+CAA+C;SAChD,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,aAAI,EAAC,4BAA4B,EAAE,KAAK,IAAI,EAAE;QAC5C,MAAM,IAAA,4BAAoB,EAAC,UAAU,EAAE,UAAU,CAAC,CAAC;IACrD,CAAC,CAAC,CAAC;IAEH,IAAA,aAAI,EAAC,kBAAkB,EAAE,KAAK,IAAI,EAAE;QAClC,MAAM,IAAA,qBAAa,EAAC,UAAU,CAAC,CAAC;IAClC,CAAC,CAAC,CAAC;IAEH,IAAA,aAAI,EAAC,6BAA6B,EAAE,KAAK,IAAI,EAAE;QAC7C,MAAM,IAAA,6BAAqB,EAAC,UAAU,EAAE,UAAU,CAAC,CAAC;IACtD,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["import * as path from 'node:path';\nimport { Integration } from '../../lib/Constants';\nimport {\n  KEYS,\n  checkEnvBuildPlugin,\n  cleanupGit,\n  revertLocalChanges,\n} from '../utils';\nimport { startWizardInstance } from '../utils';\nimport {\n  checkFileContents,\n  checkFileExists,\n  checkIfBuilds,\n  checkIfRunsOnDevMode,\n  checkIfRunsOnProdMode,\n  checkPackageJson,\n} from '../utils';\nimport { describe, beforeAll, afterAll, test } from 'vitest';\n\ndescribe('NextJS-15', () => {\n  const integration = Integration.nextjs;\n  const projectDir = path.resolve(\n    __dirname,\n    '../test-applications/nextjs-15-test-app',\n  );\n\n  beforeAll(async () => {\n    const wizardInstance = startWizardInstance(integration, projectDir);\n    const packageManagerPrompted = await wizardInstance.waitForOutput(\n      'Please select your package manager.',\n    );\n\n    const routeThroughNextJsPrompted =\n      packageManagerPrompted &&\n      (await wizardInstance.sendStdinAndWaitForOutput(\n        // Selecting `yarn` as the package manager\n        [KEYS.DOWN, KEYS.ENTER],\n        'Do you want to route Sentry requests in the browser through your Next.js server',\n        {\n          timeout: 240_000,\n        },\n      ));\n\n    const tracingOptionPrompted =\n      routeThroughNextJsPrompted &&\n      (await wizardInstance.sendStdinAndWaitForOutput(\n        [KEYS.ENTER],\n        // \"Do you want to enable Tracing\", sometimes doesn't work as `Tracing` can be printed in bold.\n        'to track the performance of your application?',\n      ));\n\n    const replayOptionPrompted =\n      tracingOptionPrompted &&\n      (await wizardInstance.sendStdinAndWaitForOutput(\n        [KEYS.ENTER],\n        // \"Do you want to enable Sentry Session Replay\", sometimes doesn't work as `Sentry Session Replay` can be printed in bold.\n        'to get a video-like reproduction of errors during a user session?',\n      ));\n\n    const examplePagePrompted =\n      replayOptionPrompted &&\n      (await wizardInstance.sendStdinAndWaitForOutput(\n        [KEYS.ENTER],\n        'Do you want to create an example page',\n        {\n          optional: true,\n        },\n      ));\n\n    const ciCdPrompted =\n      examplePagePrompted &&\n      (await wizardInstance.sendStdinAndWaitForOutput(\n        [KEYS.ENTER],\n        'Are you using a CI/CD tool',\n      ));\n\n    ciCdPrompted &&\n      (await wizardInstance.sendStdinAndWaitForOutput(\n        // Selecting `No` for CI/CD tool\n        [KEYS.DOWN, KEYS.ENTER],\n        'Successfully installed the Sentry Next.js SDK!',\n      ));\n\n    wizardInstance.kill();\n  });\n\n  afterAll(() => {\n    revertLocalChanges(projectDir);\n    cleanupGit(projectDir);\n  });\n\n  test('package.json is updated correctly', () => {\n    checkPackageJson(projectDir, integration);\n  });\n\n  test('.env-sentry-build-plugin is created and contains the auth token', () => {\n    checkEnvBuildPlugin(projectDir);\n  });\n\n  test('example page exists', () => {\n    checkFileExists(`${projectDir}/src/app/sentry-example-page/page.tsx`);\n    checkFileExists(`${projectDir}/src/app/api/sentry-example-api/route.ts`);\n  });\n\n  test('config files created', () => {\n    checkFileExists(`${projectDir}/sentry.server.config.ts`);\n    checkFileExists(`${projectDir}/sentry.edge.config.ts`);\n  });\n\n  test('global error file exists', () => {\n    checkFileExists(`${projectDir}/src/app/global-error.tsx`);\n  });\n\n  test('instrumentation files exists', () => {\n    checkFileExists(`${projectDir}/src/instrumentation.ts`);\n    checkFileExists(`${projectDir}/src/instrumentation-client.ts`);\n  });\n\n  test('instrumentation file contains Sentry initialization', () => {\n    checkFileContents(`${projectDir}/src/instrumentation.ts`, [\n      \"import * as Sentry from '@sentry/nextjs';\",\n      `export async function register() {\n  if (process.env.NEXT_RUNTIME === 'nodejs') {\n    await import('../sentry.server.config');\n  }\n\n  if (process.env.NEXT_RUNTIME === 'edge') {\n    await import('../sentry.edge.config');\n  }\n}\n\nexport const onRequestError = Sentry.captureRequestError;`,\n    ]);\n  });\n\n  test('next.config file contains Sentry wrapper', () => {\n    checkFileContents(`${projectDir}/next.config.ts`, [\n      'import {withSentryConfig} from \"@sentry/nextjs\"',\n      'export default withSentryConfig(nextConfig, {',\n    ]);\n  });\n\n  test('runs on dev mode correctly', async () => {\n    await checkIfRunsOnDevMode(projectDir, 'Ready in');\n  });\n\n  test('builds correctly', async () => {\n    await checkIfBuilds(projectDir);\n  });\n\n  test('runs on prod mode correctly', async () => {\n    await checkIfRunsOnProdMode(projectDir, 'Ready in');\n  });\n});\n"]}