{"version":3,"file":"index.test.js","sourceRoot":"","sources":["../../../../test/utils/clack/index.test.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  abort,\n  askForToolConfigPath,\n  askForWizardLogin,\n  createNewConfigFile,\n  getPackageManager,\n  installPackage,\n} from '../../../src/utils/clack/';\n\nimport * as fs from 'node:fs';\nimport * as ChildProcess from 'node:child_process';\nimport type { PackageManager } from '../../../src/utils/package-manager';\nimport * as PackageManagerUtils from '../../../src/utils/package-manager';\n\nimport {\n  NPM,\n  PNPM,\n  YARN_V1,\n  YARN_V2,\n} from '../../../src/utils/package-manager';\n\nimport axios from 'axios';\n\n// @ts-expect-error - clack is ESM and TS complains about that. It works though\nimport * as clack from '@clack/prompts';\n\nimport * as Sentry from '@sentry/node';\n\nimport {\n  vi,\n  it,\n  describe,\n  expect,\n  beforeEach,\n  Mocked,\n  Mock,\n  afterEach,\n} from 'vitest';\n\nvi.mock('node:child_process', async () => ({\n  __esModule: true,\n  ...(await vi.importActual<typeof ChildProcess>('node:child_process')),\n}));\n\nvi.mock('@clack/prompts', () => ({\n  log: {\n    info: vi.fn(),\n    success: vi.fn(),\n    warn: vi.fn(),\n    error: vi.fn(),\n  },\n  outro: vi.fn(),\n  text: vi.fn(),\n  confirm: vi.fn(),\n  cancel: vi.fn(),\n  // passthrough for abortIfCancelled\n  isCancel: vi.fn().mockReturnValue(false),\n  spinner: vi\n    .fn()\n    .mockImplementation(() => ({ start: vi.fn(), stop: vi.fn() })),\n  select: vi.fn(),\n}));\nconst clackMock = clack as Mocked<typeof clack>;\n\nvi.mock('axios');\nconst mockedAxios = axios as Mocked<typeof axios>;\n\nvi.mock('opn', () => ({\n  default: vi.fn(() => Promise.resolve({ on: vi.fn() })),\n}));\n\nfunction mockUserResponse(fn: Mock, response: unknown) {\n  fn.mockReturnValueOnce(response);\n}\n\ndescribe('askForToolConfigPath', () => {\n  afterEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('returns undefined if users have no config file', async () => {\n    mockUserResponse(clack.confirm as Mock, false);\n\n    const result = await askForToolConfigPath('Webpack', 'webpack.config.js');\n\n    expect(clack.confirm).toHaveBeenCalledWith(\n      expect.objectContaining({\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        message: expect.stringContaining('have a Webpack config file'),\n      }),\n    );\n\n    expect(result).toBeUndefined();\n  });\n\n  it('returns the path if users have a config file and the entered path is valid', async () => {\n    mockUserResponse(clack.confirm as Mock, true);\n    mockUserResponse(clack.text as Mock, 'my.webpack.config.js');\n\n    const result = await askForToolConfigPath('Webpack', 'webpack.config.js');\n\n    expect(clack.confirm).toHaveBeenCalledWith(\n      expect.objectContaining({\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        message: expect.stringContaining('have a Webpack config file'),\n      }),\n    );\n\n    expect(clack.text).toHaveBeenCalledWith(\n      expect.objectContaining({\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        message: expect.stringContaining(\n          'enter the path to your Webpack config file',\n        ),\n      }),\n    );\n\n    expect(result).toBe('my.webpack.config.js');\n  });\n});\n\ndescribe('createNewConfigFile', () => {\n  afterEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('writes the file to disk and returns true if the file was created successfully', async () => {\n    const writeFileSpy = vi\n      .spyOn(fs.promises, 'writeFile')\n      .mockImplementation(vi.fn());\n\n    const filename = '/webpack.config.js';\n    const code = 'module.exports = {/*config...*/}';\n\n    const result = await createNewConfigFile(filename, code);\n\n    expect(result).toBe(true);\n    expect(writeFileSpy).toHaveBeenCalledWith(filename, code);\n  });\n\n  it('logs more information if provided as an argument', async () => {\n    vi.spyOn(fs.promises, 'writeFile').mockImplementation(vi.fn());\n\n    const filename = '/webpack.config.js';\n    const code = 'module.exports = {/*config...*/}';\n    const moreInfo = 'More information...';\n\n    await createNewConfigFile(filename, code, moreInfo);\n\n    expect(clack.log.info).toHaveBeenCalledTimes(1);\n    expect(clack.log.info).toHaveBeenCalledWith(\n      expect.stringContaining(moreInfo),\n    );\n  });\n\n  it('returns false and logs a warning if the file could not be created', async () => {\n    const writeFileSpy = vi\n      .spyOn(fs.promises, 'writeFile')\n      .mockImplementation(() => Promise.reject(new Error('Could not write')));\n\n    const filename = '/webpack.config.js';\n    const code = 'module.exports = {/*config...*/}';\n\n    const result = await createNewConfigFile(filename, code);\n\n    expect(result).toBe(false);\n    expect(writeFileSpy).toHaveBeenCalledWith(filename, code);\n    expect(clack.log.warn).toHaveBeenCalledTimes(1);\n  });\n\n  it('returns false if the passed path is not absolute', async () => {\n    const result = await createNewConfigFile(\n      './relative/webpack.config.js',\n      '',\n    );\n\n    expect(result).toBe(false);\n  });\n});\n\ndescribe('installPackage', () => {\n  afterEach(() => {\n    vi.clearAllMocks();\n  });\n\n  const spawnSpy = vi.spyOn(ChildProcess, 'spawn').mockImplementation(() => ({\n    // @ts-expect-error - not passing the full object but directly resolving\n    // to simulate a successful install\n    on: vi.fn((evt: 'close', cb: (args) => void) => {\n      if (evt === 'close') {\n        cb(0);\n      }\n    }),\n    // @ts-expect-error - this is fine\n    stderr: { on: vi.fn() },\n  }));\n\n  it('force-installs a package if the forceInstall flag is set', async () => {\n    const packageManagerMock: PackageManager = {\n      name: 'npm',\n      label: 'NPM',\n      installCommand: 'install',\n      buildCommand: 'npm run build',\n      runScriptCommand: 'npm run',\n      flags: '',\n      forceInstallFlag: '--force',\n      detect: vi.fn(),\n      addOverride: vi.fn(),\n    };\n\n    await installPackage({\n      alreadyInstalled: false,\n      packageName: '@some/package',\n      packageNameDisplayLabel: '@some/package',\n      forceInstall: true,\n      askBeforeUpdating: false,\n      packageManager: packageManagerMock,\n    });\n\n    expect(spawnSpy).toHaveBeenCalledWith(\n      'npm',\n      ['install', '@some/package', '--force'],\n      { shell: true, stdio: ['pipe', 'ignore', 'pipe'] },\n    );\n  });\n\n  it.each([false, undefined])(\n    \"doesn't force-install a package if the forceInstall flag is %s\",\n    async (flag) => {\n      const packageManagerMock: PackageManager = {\n        name: 'npm',\n        label: 'NPM',\n        installCommand: 'install',\n        buildCommand: 'npm run build',\n        runScriptCommand: 'npm run',\n        flags: '',\n        forceInstallFlag: '--force',\n        detect: vi.fn(),\n        addOverride: vi.fn(),\n      };\n\n      await installPackage({\n        alreadyInstalled: false,\n        packageName: '@sentry/sveltekit',\n        packageNameDisplayLabel: '@sentry/sveltekit',\n        forceInstall: flag,\n        askBeforeUpdating: false,\n        packageManager: packageManagerMock,\n      });\n\n      expect(spawnSpy).toHaveBeenCalledWith(\n        'npm',\n        ['install', '@sentry/sveltekit'],\n        { shell: true, stdio: ['pipe', 'ignore', 'pipe'] },\n      );\n    },\n  );\n\n  it('adds install flags if defined', async () => {\n    const packageManagerMock: PackageManager = {\n      name: 'npm',\n      label: 'NPM',\n      installCommand: 'install',\n      buildCommand: 'npm run build',\n      runScriptCommand: 'npm run',\n      flags: '--ignore-workspace-root-check',\n      forceInstallFlag: '--force',\n      detect: vi.fn(),\n      addOverride: vi.fn(),\n    };\n\n    await installPackage({\n      alreadyInstalled: false,\n      packageName: '@some/package',\n      packageNameDisplayLabel: '@some/package',\n      forceInstall: true,\n      askBeforeUpdating: false,\n      packageManager: packageManagerMock,\n    });\n\n    expect(spawnSpy).toHaveBeenCalledWith(\n      'npm',\n\n      ['install', '@some/package', '--ignore-workspace-root-check', '--force'],\n      { shell: true, stdio: ['pipe', 'ignore', 'pipe'] },\n    );\n  });\n});\n\ndescribe('askForWizardLogin', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n    mockedAxios.get.mockClear();\n    clackMock.confirm.mockClear();\n    clackMock.confirm.mockReset();\n    mockUserResponse(clack.confirm as Mock, undefined);\n  });\n\n  it('asks if a user already has a Sentry account by default', async () => {\n    mockUserResponse(clack.confirm as Mock, Promise.resolve(true));\n\n    // Provide the data object to be returned\n    mockedAxios.get.mockResolvedValue({\n      data: {\n        hash: 'mockedHash',\n      },\n    });\n\n    await askForWizardLogin({ url: 'https://santry.io/' });\n\n    expect(clack.confirm).toHaveBeenCalledWith(\n      expect.objectContaining({\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        message: expect.stringContaining('already have a Sentry account'),\n      }),\n    );\n  });\n\n  it('skips asking for if a user already has a Sentry account if org and project are pre-selected', async () => {\n    mockUserResponse(clackMock.confirm as Mock, Promise.resolve(true));\n\n    // Provide the data object to be returned\n    mockedAxios.get.mockResolvedValue({\n      data: {\n        hash: 'mockedHash',\n      },\n    });\n\n    await askForWizardLogin({\n      url: 'https://santry.io/',\n      orgSlug: 'my-org',\n      projectSlug: 'my-project',\n    });\n\n    expect(clack.confirm).not.toHaveBeenCalled();\n  });\n});\n\ndescribe('abort', () => {\n  const sentryTxn = {\n    setStatus: vi.fn(),\n    finish: vi.fn(),\n  };\n\n  let sentrySession = {\n    status: 999,\n  };\n\n  beforeEach(() => {\n    vi.clearAllMocks();\n    sentrySession = {\n      status: 999,\n    };\n  });\n\n  vi.spyOn(Sentry, 'getCurrentHub').mockReturnValue({\n    getScope: () => ({\n      // @ts-expect-error - don't care about the rest of the required props value\n      getTransaction: () => sentryTxn,\n      // @ts-expect-error - don't care about the rest of the required props value\n      getSession: () => sentrySession,\n    }),\n    captureSession: vi.fn(),\n  });\n\n  const flushSpy = vi.fn();\n  vi.spyOn(Sentry, 'flush').mockImplementation(flushSpy);\n\n  it('ends the process with an error exit code by default', async () => {\n    // @ts-expect-error - vitest doesn't like the empty function\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    const exitSpy = vi.spyOn(process, 'exit').mockImplementation(() => {});\n\n    await abort();\n\n    expect(exitSpy).toHaveBeenCalledWith(1);\n\n    expect(clackMock.outro).toHaveBeenCalledTimes(1);\n    expect(clackMock.outro).toHaveBeenCalledWith('Wizard setup cancelled.');\n\n    expect(sentryTxn.setStatus).toHaveBeenLastCalledWith('aborted');\n    expect(sentryTxn.finish).toHaveBeenCalledTimes(1);\n    expect(sentrySession.status).toBe('crashed');\n    expect(flushSpy).toHaveBeenLastCalledWith(3000);\n  });\n\n  it('ends the process with a custom exit code and message if provided', async () => {\n    // @ts-expect-error - vitest doesn't like the empty function\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    const exitSpy = vi.spyOn(process, 'exit').mockImplementation(() => {});\n\n    await abort('Bye', 0);\n\n    expect(exitSpy).toHaveBeenCalledWith(0);\n\n    expect(clackMock.outro).toHaveBeenCalledTimes(1);\n    expect(clackMock.outro).toHaveBeenCalledWith('Bye');\n\n    expect(sentryTxn.setStatus).toHaveBeenLastCalledWith('cancelled');\n    expect(sentryTxn.finish).toHaveBeenCalledTimes(1);\n    expect(sentrySession.status).toBe('abnormal');\n    expect(flushSpy).toHaveBeenLastCalledWith(3000);\n  });\n});\n\ndescribe('getPackageManager', () => {\n  afterEach(() => {\n    vi.clearAllMocks();\n    // @ts-expect-error - this variable is set by the wizard\n    delete global.__sentry_wizard_cached_package_manager;\n  });\n\n  it('returns the auto-detected package manager', async () => {\n    const detectPacManSpy = vi\n      .spyOn(PackageManagerUtils, '_detectPackageManger')\n      .mockReturnValueOnce(YARN_V1);\n\n    const packageManager = await getPackageManager();\n\n    expect(detectPacManSpy).toHaveBeenCalledTimes(1);\n\n    expect(packageManager).toBe(YARN_V1);\n  });\n\n  it('caches the auto-detected package manager', async () => {\n    const detectPacManSpy = vi\n      .spyOn(PackageManagerUtils, '_detectPackageManger')\n      .mockReturnValueOnce(YARN_V1);\n\n    const packageManager1 = await getPackageManager();\n    const packageManager2 = await getPackageManager();\n\n    expect(detectPacManSpy).toHaveBeenCalledTimes(1);\n\n    expect(packageManager1).toBe(YARN_V1);\n    expect(packageManager2).toBe(YARN_V1);\n  });\n\n  describe('when auto detection fails', () => {\n    it('returns a fallback package manager if fallback is specified', async () => {\n      const detectPacManSpy = vi\n        .spyOn(PackageManagerUtils, '_detectPackageManger')\n        .mockReturnValueOnce(null);\n\n      const packageManager = await getPackageManager(YARN_V2);\n\n      expect(detectPacManSpy).toHaveBeenCalledTimes(1);\n\n      expect(packageManager).toBe(YARN_V2);\n    });\n\n    it(\"doesn't cache the fallback package manager\", async () => {\n      const detectPacManSpy = vi\n        .spyOn(PackageManagerUtils, '_detectPackageManger')\n        .mockReturnValue(null);\n\n      const packageManager1 = await getPackageManager(YARN_V2);\n      const packageManager2 = await getPackageManager(NPM);\n\n      expect(detectPacManSpy).toHaveBeenCalledTimes(2);\n\n      expect(packageManager1).toBe(YARN_V2);\n      expect(packageManager2).toBe(NPM);\n    });\n\n    it('returns the user-selected package manager if no fallback is provided', async () => {\n      const detectPacManSpy = vi\n        .spyOn(PackageManagerUtils, '_detectPackageManger')\n        .mockReturnValueOnce(null);\n\n      clackMock.select.mockReturnValueOnce(Promise.resolve(PNPM));\n\n      const packageManager = await getPackageManager();\n\n      expect(detectPacManSpy).toHaveBeenCalledTimes(1);\n      expect(packageManager).toBe(PNPM);\n    });\n\n    it('caches the user-selected package manager', async () => {\n      const detectPacManSpy = vi\n        .spyOn(PackageManagerUtils, '_detectPackageManger')\n        .mockReturnValueOnce(null);\n\n      clackMock.select.mockReturnValueOnce(Promise.resolve(PNPM));\n\n      const packageManager1 = await getPackageManager();\n      const packageManager2 = await getPackageManager();\n\n      expect(detectPacManSpy).toHaveBeenCalledTimes(1);\n      expect(clackMock.select).toHaveBeenCalledTimes(1);\n\n      expect(packageManager1).toBe(PNPM);\n      expect(packageManager2).toBe(PNPM);\n    });\n  });\n});\n"]}