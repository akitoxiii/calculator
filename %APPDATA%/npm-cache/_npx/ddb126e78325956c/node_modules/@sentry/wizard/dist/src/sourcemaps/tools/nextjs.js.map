{"version":3,"file":"nextjs.js","sourceRoot":"","sources":["../../../../src/sourcemaps/tools/nextjs.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,+EAA+E;AAC/E,sDAAwC;AACxC,kDAA0B;AAC1B,8DAA6D;AAC7D,+CAA4C;AAC5C,6CAG2B;AAK3B,qDAAuC;AAEvC,MAAM,cAAc,GAAG,CAAC,OAAgD,EAAE,EAAE,CAC1E,eAAK,CAAC,IAAI,CAAC;IACT,eAAK,CAAC,WAAW,CACjB,yDAAyD,CAC1D;;;;;;IAMC,eAAK,CAAC,WAAW,CAAC;YACV,OAAO,CAAC,OAAO;gBACX,OAAO,CAAC,WAAW,KAC/B,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC,eAAe,OAAO,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,EACxD;KACG,CAAC;;IAEF,eAAK,CAAC,WAAW,CAAC;;;KAGjB,CAAC;;IAEF,eAAK,CAAC,WAAW,CAAC;;;;KAIjB,CAAC;CACL,CAAC,CAAC;AAEI,MAAM,+BAA+B,GAAG,KAAK,EAClD,OAAgD,EAChD,aAA4B,EAC5B,EAAE;IACF,KAAK,CAAC,GAAG;SACN,IAAI,CAAC;;;mFAGyE,eAAK,CAAC,IAAI,CACzF,gBAAgB,CACjB,yBAAyB,CAAC,CAAC;IAE5B,MAAM,cAAc,GAAY,MAAM,IAAA,wBAAgB,EACpD,KAAK,CAAC,MAAM,CAAC;QACX,OAAO,EAAE,uDAAuD;QAChE,OAAO,EAAE;YACP;gBACE,KAAK,EAAE,sBAAsB;gBAC7B,KAAK,EAAE,IAAI;gBACX,IAAI,EAAE,8CAA8C;aACrD;YACD;gBACE,KAAK,EAAE,0CAA0C;gBACjD,KAAK,EAAE,KAAK;aACb;SACF;KACF,CAAC,CACH,CAAC;IAEF,MAAM,CAAC,MAAM,CAAC,wBAAwB,EAAE,cAAc,CAAC,CAAC;IAExD,IAAI,cAAc,EAAE;QAClB,MAAM,IAAA,qBAAS,EAAC,mBAAmB,EAAE,GAAG,EAAE,CAAC,IAAA,+BAAe,EAAC,aAAa,CAAC,CAAC,CAAC;QAC3E,KAAK,CAAC,KAAK,CAAC,gDAAgD,CAAC,CAAC;QAC9D,KAAK,CAAC,GAAG,CAAC,IAAI,CACZ,+DAA+D,CAChE,CAAC;KACH;SAAM;QACL,KAAK,CAAC,GAAG,CAAC,IAAI,CACZ,kCAAkC,eAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAClE,CAAC;QAEF,iDAAiD;QACjD,sCAAsC;QACtC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAErC,MAAM,IAAA,qBAAS,EAAC,4BAA4B,EAAE,GAAG,EAAE,CACjD,IAAA,wBAAgB,EACd,KAAK,CAAC,MAAM,CAAC;YACX,OAAO,EAAE,8BAA8B;YACvC,OAAO,EAAE,CAAC,EAAE,KAAK,EAAE,gBAAgB,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;YACnD,YAAY,EAAE,IAAI;SACnB,CAAC,CACH,CACF,CAAC;QAEF,MAAM,IAAA,qBAAS,EAAC,2BAA2B,EAAE,GAAG,EAAE,CAChD,IAAA,sCAA8B,EAAC,OAAO,CAAC,SAAS,CAAC,CAClD,CAAC;KACH;IAED,KAAK,CAAC,GAAG;SACN,IAAI,CAAC;;;;;;2EAMiE,CAAC,CAAC;AAC7E,CAAC,CAAC;AArEW,QAAA,+BAA+B,mCAqE1C","sourcesContent":["// @ts-expect-error - clack is ESM and TS complains about that. It works though\nimport * as clack from '@clack/prompts';\nimport chalk from 'chalk';\nimport { runNextjsWizard } from '../../nextjs/nextjs-wizard';\nimport { traceStep } from '../../telemetry';\nimport {\n  abortIfCancelled,\n  addDotEnvSentryBuildPluginFile,\n} from '../../utils/clack';\nimport type { WizardOptions } from '../../utils/types';\n\nimport type { SourceMapUploadToolConfigurationOptions } from './types';\n\nimport * as Sentry from '@sentry/node';\n\nconst getCodeSnippet = (options: SourceMapUploadToolConfigurationOptions) =>\n  chalk.grey(`\n  ${chalk.greenBright(\n    'const { withSentryConfig } = require(\"@sentry/nextjs\");',\n  )}\n\n  const nextConfig = {\n    // your existing next config\n  };\n\n  ${chalk.greenBright(`const sentryWebpackPluginOptions = {\n    org: \"${options.orgSlug}\",\n    project: \"${options.projectSlug}\",${\n    options.selfHosted ? `\\n    url: \"${options.url}\",` : ''\n  }\n  };`)}\n\n  ${chalk.greenBright(`const sentryOptions = {\n    // Upload additional client files (increases upload size)\n    widenClientFileUpload: true,\n  };`)}\n\n  ${chalk.greenBright(`module.exports = withSentryConfig(\n    nextConfig,\n    sentryWebpackPluginOptions,\n    sentryOptions\n  );`)}\n`);\n\nexport const configureNextJsSourceMapsUpload = async (\n  options: SourceMapUploadToolConfigurationOptions,\n  wizardOptions: WizardOptions,\n) => {\n  clack.log\n    .info(`Source Maps upload for Next.js is configured automatically by default if you run the Sentry Wizard for Next.JS.\nBut don't worry, we can redirect you to the wizard now!\n\nIn case you already tried the wizard, we can also show you how to configure your ${chalk.cyan(\n    'next.config.js',\n  )} file manually instead.`);\n\n  const shouldRedirect: boolean = await abortIfCancelled(\n    clack.select({\n      message: 'Do you want to run the Sentry Wizard for Next.JS now?',\n      options: [\n        {\n          label: 'Yes, run the wizard!',\n          value: true,\n          hint: 'The wizard can also configure your SDK setup',\n        },\n        {\n          label: 'No, show me how to configure it manually',\n          value: false,\n        },\n      ],\n    }),\n  );\n\n  Sentry.setTag('redirect-nextjs-wizard', shouldRedirect);\n\n  if (shouldRedirect) {\n    await traceStep('run-nextjs-wizard', () => runNextjsWizard(wizardOptions));\n    clack.intro('Sentry Source Maps Upload Configuration Wizard');\n    clack.log.info(\n      \"Welcome back to the Source Maps wizard - we're almost done ;)\",\n    );\n  } else {\n    clack.log.info(\n      `Add the following code to your ${chalk.cyan('next.config.js')}:`,\n    );\n\n    // Intentionally logging directly to console here\n    // eslint-disable-next-line no-console\n    console.log(getCodeSnippet(options));\n\n    await traceStep('nextjs-manual-nextconfigjs', () =>\n      abortIfCancelled(\n        clack.select({\n          message: 'Did you copy the code above?',\n          options: [{ label: 'Yes, continue!', value: true }],\n          initialValue: true,\n        }),\n      ),\n    );\n\n    await traceStep('nextjs-manual-sentryclirc', () =>\n      addDotEnvSentryBuildPluginFile(options.authToken),\n    );\n  }\n\n  clack.log\n    .info(`In case you still run into problems, check out our docs to further debug your setup:\n\nUploading Source Maps:\nhttps://docs.sentry.io/platforms/javascript/guides/nextjs/manual-setup/#configure-source-maps\n\nTroubleshooting Source Maps:\nhttps://docs.sentry.io/platforms/javascript/guides/nextjs/troubleshooting/`);\n};\n"]}